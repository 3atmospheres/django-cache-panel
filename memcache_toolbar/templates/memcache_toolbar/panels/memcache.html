<h4>Calls:</h4>
<h5>{{ count }} calls in {{ duration }}ms</h5>
<table>
    <thead>
        <tr>
            <th>Start Time</th>
            <th>Duration (ms)</th>
            <th>Call</th>
            <th>Args</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for call in calls %}
        <tr>
            <td>{{ call.start|date:'H:i:s.u' }}</td>
            <td>{{ call.duration }}</td>
            <td>{{ call.function }}</td>
            <td>{{ call.args }}</td>
            <td>
                <a class="djMemcacheShowStacktrace" href="#">Stacktrace</a>
                {% if call.exception %}
                {{ call.exception }}
                {% endif %}
            </td>
        </tr>
        <tr class='djMemcacheStacktrace' style='display:none;'>
            <td>
            </td>
            <td colspan=4>
                <table>
                    <tr>
                        <th style='text-align:left'>File</th>
                        <th style='text-align:left'>Line</th>
                        <th style='text-align:left'>Function</th>
                    </tr>
                    {% for file, line, function in call.stacktrace %}
                    <tr>
                        <td><code>{{ file|escape }}</code></td>
                        <td>{{ line }}</td>
                        <td><code>{{ function|escape }}</code></td>
                    </tr>
                    {% endfor %}
                </table>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<script type="text/javascript">
// the way ddt is using jquery we can't get at it after the fact.  our options
// are to reload the whole thing or to not use jquery, for now we'll reload...
// :( this is just about a copy of toolbar.js from ddt
(function(window, document, version, callback) {
    var j, d;
    var loaded = false;
    if (!(j = window.jQuery) || version > j.fn.jquery || callback(j)) {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = DEBUG_TOOLBAR_MEDIA_URL + "js/jquery.js";
        script.onload = script.onreadystatechange = function() {
            if (!loaded && (!(d = this.readyState) || d == "loaded" || d == "complete")) {
                callback((j = window.jQuery).noConflict(1), loaded = true);
                j(script).remove();
            }
        };
        document.documentElement.childNodes[0].appendChild(script)
    }
})(window, document, "1.3", function($, jquery_loaded) {
    $('a.djMemcacheShowStacktrace').click(function(ev) {
        ev.preventDefault();
        $(this).parent().parent().next().toggle();
        return false;
    });
});
</script>
